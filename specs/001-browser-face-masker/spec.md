# Feature Specification: Browser Face Masker

**Feature Branch**: `001-browser-face-masker`  
**Created**: 2026-01-07  
**Status**: Draft  
**Input**: User description: "사용자가 촬영한 사진을 Web, Social Service 등에 공유하기 전에, 원치 않는 사람들의 얼굴을 가리는 기능을 수행하는 Web App을 개발하려고 합니다. 조금 더 상세하게는 로컬에 저장된 사진 또는 영상을 불러온 다음, 해당 사진에 포함된 사람 얼굴을 찾아서 사용자에게 보여주고, 사용자가 선택한 얼굴을 전체 사진에서 마스킹 처리할 수 있는 앱을 개발하려고 합니다. 모든 기능은 사용자의 Web Browser에서 동작해야 합니다. 어떠한 데이터도 사용자의 Web Browser의 바깥으로 전송되어서는 안됩니다. 따라서, (가능하다면) WebGPU를 사용하여 Web Browser 내에서 얼굴을 찾고, 마스킹을 하는 Web App을 개발하려고 합니다. 마스킹 방식은 Blur 또는 이모티콘을 덮어쓰기 등의 방법을 사용자가 선택하여 적용할 수 있습니다."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Upload and Detect Faces in Image (Priority: P1)

사용자가 로컬 기기에서 사진을 업로드하면, 시스템이 자동으로 사진 내 모든 얼굴을 감지하여 화면에 표시한다. 사용자는 감지된 얼굴들을 확인할 수 있다.

**Why this priority**: 얼굴 감지는 전체 기능의 핵심이며, 이 기능 없이는 마스킹 기능을 제공할 수 없다. 가장 기본적이고 필수적인 기능이다.

**Independent Test**: 사용자가 사진을 업로드하고 감지된 얼굴 주변에 시각적 표시(바운딩 박스)가 나타나는지 확인하여 독립적으로 테스트 가능하다.

**Acceptance Scenarios**:

1. **Given** 사용자가 앱의 메인 화면에 있을 때, **When** 로컬 이미지 파일(JPG, PNG, WEBP)을 업로드하면, **Then** 이미지가 화면에 표시되고 감지된 모든 얼굴에 바운딩 박스가 표시된다
2. **Given** 얼굴이 포함된 이미지가 업로드되었을 때, **When** 얼굴 감지가 완료되면, **Then** 감지된 얼굴 수가 사용자에게 표시된다
3. **Given** 얼굴이 없는 이미지가 업로드되었을 때, **When** 얼굴 감지가 완료되면, **Then** "얼굴이 감지되지 않았습니다" 메시지가 표시된다

---

### User Story 2 - Select Faces for Masking (Priority: P1)

사용자가 감지된 얼굴 중 마스킹하고 싶은 얼굴을 선택하거나 선택 해제할 수 있다. 선택된 얼굴은 시각적으로 구분된다.

**Why this priority**: 사용자가 원하는 얼굴만 선택적으로 마스킹할 수 있어야 하므로, 얼굴 감지와 함께 핵심 기능이다.

**Independent Test**: 감지된 얼굴을 클릭하여 선택/해제가 토글되고 시각적 피드백이 제공되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 얼굴이 감지된 이미지가 표시될 때, **When** 사용자가 얼굴 바운딩 박스를 클릭하면, **Then** 해당 얼굴이 선택되고 시각적으로 구분된다(색상 변경 등)
2. **Given** 얼굴이 선택된 상태에서, **When** 사용자가 해당 얼굴을 다시 클릭하면, **Then** 선택이 해제된다
3. **Given** 여러 얼굴이 감지되었을 때, **When** 사용자가 "전체 선택" 버튼을 클릭하면, **Then** 모든 얼굴이 선택된다
4. **Given** 얼굴들이 선택된 상태에서, **When** 사용자가 "전체 해제" 버튼을 클릭하면, **Then** 모든 선택이 해제된다

---

### User Story 3 - Apply Masking to Selected Faces (Priority: P1)

사용자가 선택한 얼굴에 마스킹 효과를 적용한다. 블러, 이모티콘 등 다양한 마스킹 방식을 선택할 수 있다.

**Why this priority**: 마스킹 적용은 앱의 핵심 가치를 전달하는 기능으로, 선택된 얼굴에 실제 마스킹을 적용해야 한다.

**Independent Test**: 선택된 얼굴에 각 마스킹 방식을 적용하고 미리보기에서 결과를 확인한다.

**Acceptance Scenarios**:

1. **Given** 하나 이상의 얼굴이 선택되었을 때, **When** 사용자가 "블러" 마스킹 옵션을 선택하면, **Then** 선택된 얼굴에 블러 효과가 적용되어 미리보기에 표시된다
2. **Given** 하나 이상의 얼굴이 선택되었을 때, **When** 사용자가 "이모티콘" 마스킹 옵션을 선택하면, **Then** 선택된 얼굴 위에 이모티콘이 표시된다
3. **Given** 마스킹이 적용된 상태에서, **When** 사용자가 다른 마스킹 방식을 선택하면, **Then** 즉시 새로운 마스킹 방식으로 변경되어 표시된다
4. **Given** 블러 마스킹이 선택되었을 때, **When** 사용자가 블러 강도를 조절하면, **Then** 블러 강도가 실시간으로 변경되어 표시된다

---

### User Story 4 - Download Masked Image (Priority: P1)

사용자가 마스킹이 적용된 이미지를 로컬 기기에 다운로드할 수 있다.

**Why this priority**: 최종 결과물을 저장하는 것은 앱 사용의 완결이며, 이 기능 없이는 앱의 목적을 달성할 수 없다.

**Independent Test**: 마스킹된 이미지를 다운로드하고, 다운로드된 파일에 마스킹이 올바르게 적용되어 있는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 마스킹이 적용된 이미지가 있을 때, **When** 사용자가 "다운로드" 버튼을 클릭하면, **Then** 마스킹이 적용된 이미지가 로컬 기기에 다운로드된다
2. **Given** 다운로드 버튼을 클릭했을 때, **When** 다운로드가 시작되면, **Then** 사용자가 파일명과 형식(JPG, PNG)을 선택할 수 있다
3. **Given** 마스킹된 이미지를 다운로드할 때, **When** 원본 이미지가 고해상도일 경우, **Then** 다운로드된 이미지도 원본 해상도를 유지한다

---

### User Story 5 - Upload and Process Video (Priority: P2)

사용자가 영상 파일을 업로드하면, 시스템이 영상 내 얼굴을 감지하고 마스킹을 적용할 수 있다.

**Why this priority**: 영상 처리는 이미지 처리보다 복잡하고 리소스 집약적이므로, 이미지 기능이 완성된 후 추가되어야 한다.

**Independent Test**: 짧은 영상을 업로드하고 얼굴 감지 및 마스킹이 각 프레임에 적용되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 앱의 메인 화면에 있을 때, **When** 영상 파일(MP4, WEBM)을 업로드하면, **Then** 영상이 로드되고 첫 프레임에서 얼굴이 감지된다
2. **Given** 영상이 로드되었을 때, **When** 사용자가 재생 버튼을 누르면, **Then** 영상이 재생되면서 실시간으로 얼굴이 감지되고 마스킹이 적용된다
3. **Given** 마스킹이 적용된 영상이 있을 때, **When** 사용자가 "영상 저장" 버튼을 클릭하면, **Then** 마스킹이 적용된 영상이 로컬에 저장된다

---

### User Story 6 - Choose Emoji Style (Priority: P3)

이모티콘 마스킹 시 사용자가 원하는 이모티콘을 선택할 수 있다.

**Why this priority**: 커스터마이징 옵션으로, 핵심 기능은 아니지만 사용자 경험을 향상시킨다.

**Independent Test**: 이모티콘 마스킹 선택 후 다양한 이모티콘으로 변경하고 적용 결과를 확인한다.

**Acceptance Scenarios**:

1. **Given** 이모티콘 마스킹이 선택되었을 때, **When** 사용자가 이모티콘 선택 패널을 열면, **Then** 사용 가능한 이모티콘 목록이 표시된다
2. **Given** 이모티콘 목록이 표시될 때, **When** 사용자가 특정 이모티콘을 선택하면, **Then** 해당 이모티콘이 선택된 얼굴에 적용된다

---

### Edge Cases

- 얼굴이 부분적으로만 보이는 경우(프레임 가장자리에 걸친 얼굴)?
  - 시스템은 부분적으로 보이는 얼굴도 감지를 시도하며, 감지된 경우 마스킹 적용 가능
- 매우 작거나 큰 얼굴이 있는 경우?
  - 얼굴 크기에 관계없이 감지 시도, 마스킹은 감지된 영역에 자동 크기 조절
- 이미지 파일이 손상된 경우?
  - 적절한 오류 메시지 표시 ("파일을 읽을 수 없습니다")
- 지원하지 않는 파일 형식인 경우?
  - "지원하지 않는 파일 형식입니다" 메시지와 함께 지원 형식 안내
- 브라우저가 WebGPU를 지원하지 않는 경우?
  - WebGL 또는 CPU 기반 fallback으로 동작, 성능 저하 가능성 안내
- 매우 큰 이미지 파일(50MB 이상)인 경우?
  - 처리 가능하나 시간이 오래 걸릴 수 있음을 안내하는 진행 표시
- 네트워크가 끊어진 상태에서 사용하는 경우?
  - 앱 최초 로드 후에는 완전히 오프라인으로 동작 가능

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 로컬 기기에서 이미지 파일(JPG, PNG, WEBP)을 업로드받을 수 있어야 한다
- **FR-002**: 시스템은 업로드된 이미지에서 사람 얼굴을 자동으로 감지해야 한다
- **FR-003**: 시스템은 감지된 얼굴을 시각적으로 표시(바운딩 박스)해야 한다
- **FR-004**: 사용자는 감지된 얼굴을 개별적으로 선택/해제할 수 있어야 한다
- **FR-005**: 사용자는 "전체 선택" 및 "전체 해제" 기능을 사용할 수 있어야 한다
- **FR-006**: 시스템은 블러 마스킹 방식을 제공해야 한다
- **FR-007**: 시스템은 이모티콘 마스킹 방식을 제공해야 한다
- **FR-008**: 사용자는 블러 강도를 조절할 수 있어야 한다
- **FR-009**: 시스템은 마스킹 적용 결과를 실시간 미리보기로 제공해야 한다
- **FR-010**: 사용자는 마스킹된 이미지를 로컬 기기에 다운로드할 수 있어야 한다
- **FR-011**: 사용자는 다운로드 시 파일 형식(JPG, PNG)을 선택할 수 있어야 한다
- **FR-012**: 모든 이미지 처리는 사용자의 웹 브라우저 내에서만 수행되어야 한다
- **FR-013**: 어떠한 사용자 데이터(이미지, 영상)도 외부 서버로 전송되어서는 안 된다
- **FR-014**: 시스템은 영상 파일(MP4, WEBM) 업로드를 지원해야 한다 (P2)
- **FR-015**: 시스템은 영상에서 얼굴을 감지하고 마스킹을 적용할 수 있어야 한다 (P2)
- **FR-016**: 사용자는 마스킹된 영상을 로컬에 저장할 수 있어야 한다 (P2)
- **FR-017**: 사용자는 이모티콘 마스킹 시 이모티콘 종류를 선택할 수 있어야 한다 (P3)
- **FR-018**: 시스템은 WebGPU를 지원하지 않는 브라우저에서도 동작해야 한다 (fallback 제공)

### Key Entities

- **Media File**: 사용자가 업로드한 이미지 또는 영상. 원본 데이터, 파일 형식, 크기 정보 포함
- **Detected Face**: 감지된 얼굴 영역. 위치(x, y), 크기(width, height), 선택 상태 포함
- **Mask Configuration**: 마스킹 설정. 마스킹 유형(blur/emoji), 블러 강도, 선택된 이모티콘 종류 포함
- **Masked Result**: 마스킹이 적용된 최종 결과물. 다운로드 가능한 형태

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자가 이미지 업로드부터 마스킹된 이미지 다운로드까지 전체 작업을 3분 이내에 완료할 수 있다
- **SC-002**: 일반적인 사진(5-10명의 얼굴)에서 얼굴 감지가 10초 이내에 완료된다
- **SC-003**: 마스킹 옵션 변경 시 미리보기가 1초 이내에 업데이트된다
- **SC-004**: 95% 이상의 정면 얼굴이 정확하게 감지된다
- **SC-005**: 다운로드된 이미지 품질이 원본과 동일하게 유지된다
- **SC-006**: 사용자가 별도의 소프트웨어 설치 없이 웹 브라우저만으로 모든 기능을 사용할 수 있다
- **SC-007**: 처음 사용하는 사용자가 도움말 없이 핵심 기능을 사용할 수 있다 (직관적 UI)
- **SC-008**: 앱 최초 로드 후 인터넷 연결 없이도 완전히 동작한다

## Assumptions

- 사용자는 현대적인 웹 브라우저(Chrome, Firefox, Safari, Edge의 최신 버전)를 사용한다
- 대부분의 사용자 기기는 WebGPU 또는 최소한 WebGL을 지원한다
- 얼굴 감지는 정면 및 약간 측면 얼굴에 최적화되어 있으며, 극단적인 각도의 얼굴은 감지되지 않을 수 있다
- 일반적인 사진 크기(10MP 이하)가 주요 사용 사례이며, 매우 큰 이미지는 처리 시간이 길어질 수 있다
- 영상 처리 기능(P2)은 짧은 클립(수 분 이내)을 대상으로 하며, 긴 영상은 성능 제한이 있을 수 있다
- 이모티콘 기본 세트는 범용적인 이모티콘(웃는 얼굴, 하트, 선글라스 등)을 포함한다

## Scope Boundaries

### In Scope
- 이미지에서 얼굴 감지 및 마스킹
- 영상에서 얼굴 감지 및 마스킹 (P2)
- 블러 및 이모티콘 마스킹 방식
- 브라우저 내 완전 로컬 처리
- 결과물 로컬 다운로드

### Out of Scope
- 사용자 계정 및 인증
- 클라우드 저장소 연동
- 소셜 미디어 직접 공유 기능
- 실시간 카메라 캡처 및 마스킹
- 다른 객체(번호판, 텍스트 등) 마스킹
- 이미지 편집 기능(자르기, 회전, 필터 등)
